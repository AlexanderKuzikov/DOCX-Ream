const fs = require('fs');
const path = require('path');

console.log('\n--- üïµÔ∏è –ù–ê–ß–ò–ù–ê–ï–ú –î–ò–ê–ì–ù–û–°–¢–ò–ö–£ ---');

// 1. –ì–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è?
const cwd = process.cwd();
console.log(`1. –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç):`);
console.log(`   üëâ ${cwd}`);

// 2. –ò—â–µ–º –ø–∞–ø–∫—É data
const dataDir = path.join(cwd, 'data');
console.log(`\n2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–ø–∫—É data –ø–æ –ø—É—Ç–∏:`);
console.log(`   üëâ ${dataDir}`);

if (!fs.existsSync(dataDir)) {
    console.error('   ‚ùå –û–®–ò–ë–ö–ê: –ü–∞–ø–∫–∞ data –≤–æ–æ–±—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
    console.log('      –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞.');
    process.exit(1);
} else {
    console.log('   ‚úÖ –ü–∞–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞.');
}

// 3. –°–∫–∞–Ω–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã (–ò—â–µ–º —Å–∫—Ä—ã—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
console.log(`\n3. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ data (—Ç–æ—á–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞):`);
const files = fs.readdirSync(dataDir);

if (files.length === 0) {
    console.error('   ‚ùå –ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞—è!');
}

files.forEach(file => {
    // –í—ã–≤–æ–¥–∏–º –∏–º—è –≤ –∫–∞–≤—ã—á–∫–∞—Ö, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–±–µ–ª—ã –ø–æ –∫—Ä–∞—è–º
    console.log(`   üìÑ "${file}"`);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏
    if (file === 'scenario_1.json.json') console.error('      üî¥ –û–®–ò–ë–ö–ê: –î–≤–æ–π–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (.json.json)! –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª.');
    if (file.includes(' ')) console.warn('      ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –í –∏–º–µ–Ω–∏ –µ—Å—Ç—å –ø—Ä–æ–±–µ–ª—ã.');
    if (file.toLowerCase() !== file) console.warn('      ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –í –∏–º–µ–Ω–∏ –µ—Å—Ç—å –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã (Linux/Mac —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —ç—Ç–æ–º—É).');
});

// 4. –¢–µ—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ –≤–∞—à–µ–≥–æ –ú–∞–Ω–∏—Ñ–µ—Å—Ç–∞
const targetName = 'scenario_1.json';
const targetPath = path.join(dataDir, targetName);

console.log(`\n4. –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª: ${targetName}`);
if (fs.existsSync(targetPath)) {
    console.log(`   ‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω.`);
    try {
        const content = fs.readFileSync(targetPath, 'utf8');
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ BOM (Byte Order Mark) - –Ω–µ–≤–∏–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª –≤ –Ω–∞—á–∞–ª–µ
        if (content.charCodeAt(0) === 0xFEFF) {
            console.warn('   ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω BOM (–Ω–µ–≤–∏–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª). –≠—Ç–æ –º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å JSON.parse. –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ UTF-8 –±–µ–∑ BOM.');
        }
        JSON.parse(content);
        console.log(`   ‚úÖ JSON –≤–∞–ª–∏–¥–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.`);
    } catch (e) {
        console.error(`   ‚ùå –§–∞–π–ª –µ—Å—Ç—å, –Ω–æ JSON –±–∏—Ç—ã–π: ${e.message}`);
    }
} else {
    console.error(`   ‚ùå –§–∞–π–ª –ù–ï –ù–ê–ô–î–ï–ù —Å–∏—Å—Ç–µ–º–æ–π –ø–æ –ø—É—Ç–∏:`);
    console.error(`      ${targetPath}`);
    console.error(`      –°—Ä–∞–≤–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø—É—Ç—å —Å —Ç–µ–º, –≥–¥–µ —Ä–µ–∞–ª—å–Ω–æ –ª–µ–∂–∏—Ç —Ñ–∞–π–ª.`);
}

console.log('\n--- –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ---\n');
